# config.yaml
# Main configuration for the External Context Engine (ECE) using the Youtu-agent framework.
# Version 2.0 with Decision Tree for Schema-Guided Reasoning.

# === LLM Backend Configuration ===
llm:
  provider: ollama
  config:
    model: "mistral-nemo:12b-instruct-2407-q8_0"

# === Agent Definitions ===

OrchestraAgent:
  name: "Orchestrator"
  role: "Central coordinator for the ECE, using a decision tree for transparent reasoning."
  goal: >
    Receive a user request, classify its intent using the decision tree, and then
    delegate the task to the appropriate specialist agent or tool.

  # The SGR Decision Tree defines the Orchestrator's reasoning process.
  decision_tree:
    - intent: "Memory Storage"
      keywords: ["remember", "archive", "save this", "store this", "distill"]
      description: "User wants to store information in the long-term memory."
      action_plan:
        - "Use DistillerAgent to summarize the raw text."
        - "Use ArchivistAgent to persist the structured summary to the knowledge graph."
    - intent: "Memory Retrieval"
      keywords: ["what do you know", "find", "search for", "tell me about", "what was"]
      description: "User wants to retrieve information from long-term memory."
      action_plan:
        - "Use ExtractorAgent with the user's question to query the knowledge graph."
    - intent: "Graph Optimization"
      keywords: ["optimize yourself", "run analysis", "improve the graph", "inject"]
      description: "User wants to trigger a long-running graph optimization process."
      action_plan:
        - "Use InjectorAgent to begin the asynchronous analysis."
    - intent: "Complex Reasoning"
      keywords: ["analyze", "evaluate", "plan", "what if", "strategize"]
      description: "User has a complex query that requires deep thought or planning."
      action_plan:
        - "Delegate the task to a specialized Thinker Agent." # Placeholder for HRM
    - intent: "Default"
      description: "A general conversational query."
      action_plan:
        - "Respond directly using the core LLM."

  tools:
    - DistillerAgent
    - ArchivistAgent
    - ExtractorAgent
    - InjectorAgent

# --- Specialist Agent/Tool Definitions ---

DistillerAgent:
  name: "Distiller"
  role: "Raw Data Analysis Agent"
  goal: >
    Analyze raw, unstructured session logs and conversation transcripts to identify and
    summarize high-coherency insights and key conceptual relationships in a structured format.

ArchivistAgent:
  name: "Archivist"
  role: "Knowledge Graph Persistence Agent"
  goal: >
    Take structured data (JSON) and persist it into the Neo4j knowledge graph,
    creating and updating nodes and relationships.

ExtractorAgent:
  name: "Extractor"
  role: "Knowledge Retrieval Agent"
  goal: >
    Receive a specific query, traverse the Neo4j knowledge graph to find the most
    relevant information, and return it as a structured context.

InjectorAgent:
  name: "Injector"
  role: "Graph Optimization & RL Agent"
  goal: >
    Periodically analyze the knowledge graph to identify areas for optimization and
    use reinforcement learning to infer new connections.

# --- Memory Management Configuration ---

memory_management:
  agents:
    enhanced_archivist:
      enabled: true
      llm_model: "deepseek-r1:14b-qwen-distill-q4_K_M"
      max_tokens: 4096
      max_hops: 5
      embedding_model: "all-MiniLM-L6-v2"
      timeout_seconds: 10
    
    q_learning:
      enabled: true
      learning_rate: 0.1
      discount_factor: 0.9
      epsilon: 0.1
      max_episodes: 1000
      q_table_path: "./data/q_table.npy"
    
    context_builder:
      enabled: true
      summarization_strategy: "progressive"
      max_context_tokens: 4096
      preserve_technical_details: true
  
  cache:
    redis_url: "redis://localhost:6379"
    ttl_seconds: 3600
    max_size_mb: 32768
    warmup_on_start: true
  
  gpu:
    device: "cuda:0"
    batch_size: 32
    mixed_precision: true
    memory_fraction: 0.8
  
  performance:
    max_concurrent_queries: 100
    query_timeout_seconds: 5
    connection_pool_size: 50
    batch_processing_size: 1000
